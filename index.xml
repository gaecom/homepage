<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>技术知识 on 小明的技术博客</title>
    <link>http://h.hao.vin/</link>
    <description>Recent content in 技术知识 on 小明的技术博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sat, 25 Dec 2021 19:56:07 +0800</lastBuildDate><atom:link href="http://h.hao.vin/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Log4j2 原理、漏洞应对与缓解方案</title>
      <link>http://h.hao.vin/news/security/log4j2-vulnerability-solution/</link>
      <pubDate>Sat, 25 Dec 2021 19:56:07 +0800</pubDate>
      
      <guid>http://h.hao.vin/news/security/log4j2-vulnerability-solution/</guid>
      <description>log4j漏洞介绍 阿里巴巴长亭科技发现Apache Log4j2反序列化远程代码执行漏洞（CVE-2021-44228），随后更多细节被公开，攻击者可利用该漏洞构造恶意请求，触发远程代码执行， 由于log4j2的异步快速等优异特性，打日志对生产服务影响很小，国内外很多java服务器组件使用了,造成广泛影响。
解决办法 1. 缓解办法 a. 公司内部防火墙，禁止服务器发起外网链接,需要链接的进行打补丁后,特别的开放 b. 火绒热补丁 火绒热补丁，解决了，有些生产环境的服务器，不方便重启。
 借助JVM的Attach机制, 将缓解代码注入运行中的目标JVM进程, 再使用ASM修改JVM中的org.apache.logging.log4j.core.lookup.JndiLookup方法的字节码, 达到无需重启禁用JndiLookup::lookup的目的.
 也可以使用长亭科技提供的修复 参照https://github.com/zhangyoufu/log4j2-without-jndi.git
c. 添加服务器参数,使用下列方法之一   添加 &amp;ldquo;log4j2.component.properties&amp;rdquo; 文件，在里面增加配置 &amp;ldquo;log4j2.formatMsgNoLookups=true&amp;rdquo;
  添加JVM启动参数 -Dlog4j2.formatMsgNoLookups=true
  修改系统环境变量: FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS设置为true
  2. 一劳永逸解决办法 升级系统到log4j2 2.17最新版本 3. 对于安全测试人员，运维人员如何发现公司哪些服务器有log4j2的漏洞,可以使用log4j2的漏洞扫描工具 a. 使用长亭洞鉴（X-Ray）通过模拟浏览器爬虫，对资产进行精细化爬取，以攻击者视角深入挖掘互联网侧暴露的相关组件的Apache Log4j2远程代码执行漏洞
4. 对于安全测试人员，执行漏洞渗透测试 使用以下代码进行远程代码执行
# Remote Code Execution (RCE) # Date: 11/12/2021 # Software Link: https://github.com/apache/logging-log4j2 # Version: versions 2.0-beta-9 and 2.14.1. # Tested on: Linux # CVE: CVE-2021-44228 import subprocess import sys import argparse from colorama import Fore, init import subprocess import threading from http.</description>
    </item>
    
    <item>
      <title>Log4j2 原理、漏洞应对与缓解方案</title>
      <link>http://h.hao.vin/post/security/log4j2-vulnerability-solution/</link>
      <pubDate>Sat, 25 Dec 2021 19:56:07 +0800</pubDate>
      
      <guid>http://h.hao.vin/post/security/log4j2-vulnerability-solution/</guid>
      <description>log4j漏洞介绍 阿里巴巴长亭科技发现Apache Log4j2反序列化远程代码执行漏洞（CVE-2021-44228），随后更多细节被公开，攻击者可利用该漏洞构造恶意请求，触发远程代码执行， 由于log4j2的异步快速等优异特性，打日志对生产服务影响很小，国内外很多java服务器组件使用了,造成广泛影响。
解决办法 1. 缓解办法 a. 公司内部防火墙，禁止服务器发起外网链接,需要链接的进行打补丁后,特别的开放 b. 火绒热补丁 火绒热补丁，解决了，有些生产环境的服务器，不方便重启。
 借助JVM的Attach机制, 将缓解代码注入运行中的目标JVM进程, 再使用ASM修改JVM中的org.apache.logging.log4j.core.lookup.JndiLookup方法的字节码, 达到无需重启禁用JndiLookup::lookup的目的.
 也可以使用长亭科技提供的修复 参照https://github.com/zhangyoufu/log4j2-without-jndi.git
c. 添加服务器参数,使用下列方法之一   添加 &amp;ldquo;log4j2.component.properties&amp;rdquo; 文件，在里面增加配置 &amp;ldquo;log4j2.formatMsgNoLookups=true&amp;rdquo;
  添加JVM启动参数 -Dlog4j2.formatMsgNoLookups=true
  修改系统环境变量: FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS设置为true
  2. 一劳永逸解决办法 升级系统到log4j2 2.17最新版本 3. 对于安全测试人员，运维人员如何发现公司哪些服务器有log4j2的漏洞,可以使用log4j2的漏洞扫描工具 a. 使用长亭洞鉴（X-Ray）通过模拟浏览器爬虫，对资产进行精细化爬取，以攻击者视角深入挖掘互联网侧暴露的相关组件的Apache Log4j2远程代码执行漏洞
4. 对于安全测试人员，执行漏洞渗透测试 使用以下代码进行远程代码执行
# Remote Code Execution (RCE) # Date: 11/12/2021 # Software Link: https://github.com/apache/logging-log4j2 # Version: versions 2.0-beta-9 and 2.14.1. # Tested on: Linux # CVE: CVE-2021-44228 import subprocess import sys import argparse from colorama import Fore, init import subprocess import threading from http.</description>
    </item>
    
  </channel>
</rss>
